@model LoginModuleVM;

@{
    ViewData["Title"] = "Iniciar Sesión";
}

<div class="min-vh-100 bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="d-flex align-items-center mb-4">
                    <h1 class="mb-0">RentalWeb</h1>
                </div>

                <ul class="nav nav-tabs mb-4" id="authTabs" role="tablist">
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link active w-100" id="login-tab" data-bs-toggle="tab"
                                data-bs-target="#login" type="button" role="tab"
                                aria-controls="login" aria-selected="true">
                            Iniciar Sesión
                        </button>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link w-100" id="register-tab" data-bs-toggle="tab"
                                data-bs-target="#register" type="button" role="tab"
                                aria-controls="register" aria-selected="false">
                            Registrarse
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="authTabsContent">
                    <!-- Tab de Inicio de Sesión -->
                    <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Acceder a mi cuenta</h5>
                                <p class="card-text text-muted small">
                                    Inicia sesión y accede a todas las funcionalidades
                                </p>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2 mt-3">
                                    <div class="d-grid gap-2 mt-3">
                                        <a asp-controller="Auth" asp-action="InitiateSupabaseLogin" class="btn btn-outline-dark w-100">
                                            <i class="bi bi-google me-1"></i>
                                            Iniciar sesión con Google
                                        </a>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center my-3">
                                    <hr class="flex-grow-1 border-top border-secondary">
                                    <span class="mx-2 text-muted fw-bold small">O CONTINÚA CON</span>
                                    <hr class="flex-grow-1 border-top border-secondary">
                                </div>

                                @using (Html.BeginForm("Login", "Account", FormMethod.Post))
                                {
                                    @Html.AntiForgeryToken()
                                    <div class="mb-3">
                                        <label asp-for="LoginViewModel.Email" class="form-label">
                                            <i class="bi bi-envelope me-1 text-muted"></i>
                                            Correo Electrónico
                                        </label>
                                        <input asp-for="LoginViewModel.Email" type="email" class="form-control" />
                                        <span asp-validation-for="LoginViewModel.Email" class="text-danger"></span>
                                    </div>

                                    <div class="mb-3">
                                        <label asp-for="LoginViewModel.Password" class="form-label">
                                            <i class="bi bi-lock me-1 text-muted"></i>
                                            Contraseña
                                        </label>
                                        
                                        <div class="input-group">
                                            <input asp-for="LoginViewModel.Password" type="password" class="form-control" />
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </div>
                                        <span asp-validation-for="LoginViewModel.Password" class="text-danger"></span>
                                    </div>

                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        @* <div class="form-check">
                                            <input asp-for="LoginViewModel.RememberMe" type="checkbox" class="form-check-input" value="" />
                                            <label asp-for="LoginViewModel.RememberMe" class="form-check-label">
                                                Recordarme
                                            </label>

                                        </div> *@
                                        <a href="@Url.Action("ForgotPassword", "Account")" class="text-decoration-none">
                                            ¿Olvidaste tu contraseña?
                                        </a>
                                    </div>

                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-box-arrow-in-right me-1"></i>
                                            Iniciar Sesión
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Tab de Registro -->
                    <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Crear una cuenta nueva</h5>
                                <p class="card-text text-muted small">
                                    Regístrate para comenzar a rentar o publicar artículos en nuestra plataforma
                                </p>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2 mt-3">
                                    <a asp-controller="Auth" asp-action="InitiateSupabaseLogin" class="btn btn-outline-dark w-100">
                                        <i class="bi bi-google me-1"></i>
                                       Registrarse con google
                                    </a>
                                </div>
                                <div class="d-flex align-items-center my-3">
                                    <hr class="flex-grow-1 border-top border-secondary">
                                    <span class="mx-2 text-muted fw-bold small">O REGÍSTRATE CON</span>
                                    <hr class="flex-grow-1 border-top border-secondary">
                                </div>
                                @using (Html.BeginForm("Register", "Account", FormMethod.Post, new { id = "miFormulario" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <div class="mb-3">
                                        <label asp-for="RegisterViewModel.RegisterEmail" class="form-label">
                                            <i class="bi bi-envelope me-1 text-muted"></i>
                                            Correo Electrónico
                                        </label>
                                        <input asp-for="RegisterViewModel.RegisterEmail" type="email" class="form-control" />
                                        <span asp-validation-for="RegisterViewModel.RegisterEmail" class="text-danger"></span>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-md-6 mb-3 mb-md-0">
                                            <label asp-for="RegisterViewModel.RegisterPassword" class="form-label">
                                                <i class="bi bi-lock me-1 text-muted"></i>
                                                Contraseña
                                            </label>
                                            <input asp-for="RegisterViewModel.RegisterPassword" type="password" class="form-control" id="Password" />
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="RegisterViewModel.RegisterConfirmPassword" class="form-label">
                                                <i class="bi bi-lock-fill me-1 text-muted"></i>
                                                Confirmar Contraseña
                                            </label>
                                            <input asp-for="RegisterViewModel.RegisterConfirmPassword" type="password" class="form-control" id="Confirm" />
                                            <span asp-validation-for="RegisterViewModel.RegisterConfirmPassword" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <div class="form-check">
                                            <input asp-for="RegisterViewModel.AcceptTerms" type="checkbox" class="form-check-input" id="terminosCondiciones">
                                            <label asp-for="RegisterViewModel.AcceptTerms" class="form-check-label" for="terminosCondiciones">
                                                Acepto los <a href="@Url.Action("Terms", "Home")" target="_blank">Términos y Condiciones</a> y la <a href="@Url.Action("Privacy", "Home")" target="_blank">Política de Privacidad</a>
                                            </label>
                                        </div>
                                        <div id="mensajeError" class="alert alert-danger mt-3 d-none" role="alert">
                                            Debes aceptar los términos y condiciones para continuar.
                                        </div>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary" id="btnEnviar">
                                            <i class="bi bi-person-plus me-1" ></i>
                                            Crear Cuenta
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información adicional -->
                <div class="card mt-4">
                    <div class="card-body">
                        <div class="d-flex">
                            <div class="flex-shrink-0 me-3 text-primary">
                                <i class="bi bi-info-circle-fill fs-4"></i>
                            </div>
                            <div>
                                <h5 class="card-title">¿Por qué unirte a RentalWeb?</h5>
                                <p class="card-text text-muted mb-0">
                                    Al crear una cuenta podrás publicar tus artículos para renta, gestionar tus reservaciones
                                    y comunicarte con otros usuarios. Todo desde una plataforma segura y fácil de usar.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/passwordToggle.js"></script>
    <script src="~/js/CheckValidation.js"></script>
    <script>
        $(document).ready(function() {
            // Mantener la pestaña activa después de recargar la página
            var hash = window.location.hash;
            if (hash) {
                $('#authTabs a[href="' + hash + '"]').tab('show');
            }

            // Cambiar hash para recarga de página
            $('#authTabs a').on('shown.bs.tab', function (e) {
                window.location.hash = e.target.getAttribute('data-bs-target');
            });
        });
    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}